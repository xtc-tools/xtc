import lit.formats
import os
import pkgutil

config.name = "xtc"
config.test_format = lit.formats.ShTest()
config.suffixes = ['.mlir', '.py']

config.test_source_root = os.path.dirname(__file__)
config.excludes = ['utils.py', 'experimental']
config.environment["TIMEOUT"] = "10"

config.available_features = set()

for module in ["mlir", "tvm", "jir"]:
    if pkgutil.get_loader(module) is not None:
        config.available_features.add(f"module_{module}")

# Environment passed to subprocesses
env_passthrough = [
    "COVERAGE_PROCESS_START",
    "COVERAGE_FILE",
    "PYTHONPATH",
]
config.environment.update({
    var: os.environ[var]
    for var in env_passthrough
    if var in os.environ
})
